<configuration>
  <system.webServer>
    <handlers>
      <add name="PythonHandler"
           path="*"
           verb="*"
           modules="FastCgiModule"
           scriptProcessor="C:\Python311\python.exe|C:\Python311\Scripts\wfastcgi.py"
           resourceType="Unspecified"
           requireAccess="Script">
        <environmentVariables>
          <!-- Core Django Settings -->
          <add name="DJANGO_SETTINGS_MODULE" value="backend.settings" />
          <add name="WSGI_HANDLER" value="backend.wsgi.application" />
          <add name="PYTHONPATH" value="C:\inetpub\wwwroot\zetaslate" />
          
          <!-- Logging -->
          <add name="WSGI_LOG" value="C:\inetpub\logs\django\backend.log" />
          
          <!-- Subdomain Isolation -->
          <add name="DJANGO_ALLOWED_HOSTS" value="admin.zetaslate.com,api.zetaslate.com" />
        </environmentVariables>
      </add>
    </handlers>

    <!-- URL Rewrite Rules -->
    <rewrite>
      <rules>
        <!-- Force HTTPS -->
        <rule name="Redirect HTTP to HTTPS" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="^OFF$" />
            <add input="{HTTP_HOST}" pattern="^(admin|api)\.zetaslate\.com$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>

  <!-- Increase request limits for APIs -->
  <system.web>
    <httpRuntime maxQueryStringLength="32768" maxUrlLength="65536" />
  </system.web>
</configuration>